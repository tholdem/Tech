\documentclass[12pt]{article}
\input{../preamble.tex}

\begin{document}
\centerline {\textsf{\textbf{\LARGE{Homework 6}}}}
\centerline {Jaden Wang}
\vspace{.15in}
\begin{problem}[1]
From the example, we know that optimal trajectories are clockwise-oriented circles centered at $ ( 1,0)$ for $ u=1$  and centered at $ (-1,0)$ for $ u = - 1$. To reach the origin, we must eventually get on the switching curves $ \Gamma_+^{1} $ and $ \Gamma_{-}^{1}$ since they are the only circles centered at $ (\pm1,0)$ that go through the origin. Moreover, the optimal control $ u^*  = - \text{sign}(\Lambda \cos(\omega t + \phi))$ flips signs and thus must switch every  $ \frac{\pi}{ \omega} = \pi$ except that it might switch sooner at the beginning or in the end. 

\begin{enumerate}[label=(\alph*)]
\item When $ x_1(0) = x_2(0)=2$, we have the following optimal trajectory:
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{./figures/6.1.png}
\caption{Magenta denotes the optimal trajectory and orange denotes the optimal switching curve. We first find clockwise-oriented circles centered at $ (\pm 1,0)$ that go through $ (2,2)$ and pick the one that reaches the switching surface the fastest. In this case it is the blue circle centered at  $ (-1,0)$. Then we switch to the green circle centered at $ (1,0)$ and continue for $ \pi$ unit of time to reach the next switching curve which happens to be $ \Gamma_{-}^{1}$ so we simply follow the singular curve to reach the origin.}
\end{figure}

Using $ \wh{ \Gamma}$, we have the following trajectory:
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{./figures/6.2.png}
	\caption{Magenta denotes the non-optimal trajectory and orange denotes the non-optimal switching curve. We repeat the previous first step, reach a new switching curve at $ x_2=0$, and switch to the other center. This time we don't have to switch every $ \pi$ so we simply reach the next switching curve to switch.}
\end{figure}
Since $ \omega=1$, the elapsed time is the same as the angle the trajectory traced out. By adding the angles together, we obtain that $ t^*  = 5.0194$ and $ \wh{ t} = 5.1685$.
\item We repeat the procedure for $ \omega x_1 = 3,4,5$.
~\begin{figure}[H]
	\includegraphics[width=0.49\textwidth]{./figures/6.3.png}
	\includegraphics[width=0.49\textwidth]{./figures/6.4.png}
\end{figure}
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.49\textwidth]{./figures/6.5.png}
	\includegraphics[width=0.49\textwidth]{./figures/6.6.png}
	\caption{Both trajectories becomes more complicated. We have four arcs corresponding to three switchings.}
\end{figure}
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.49\textwidth]{./figures/6.7.png}
	\includegraphics[width=0.49\textwidth]{./figures/6.8.png}
\end{figure}
From the figures, we can roughly see that the optimal trajectories and their non-optimal counterparts largely resembles each other. Moreover, it is not hard to imagine that as $ \omega x_1$ gets larger, the total angles traced out by both trajectories increase but their differences don't increase much. Thus the ratio $ \wh{ t} / t^* $ trends down to 1. There is not enough sample size in the following plot to fully illustrate that but it is a start:
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.55\textwidth]{./figures/6.15.png}
	\caption{The ratio fluctuates but trends down.}
\end{figure}

\end{enumerate}
\end{problem}


\begin{problem}[2]
The Hamiltonian is
\begin{align*}
	H &= \frac{1}{2} x_1^2 + p_1(x_2+u) + p_2(-u)\\
	&= \frac{1}{2}x_1^2+p_1x_2 +(p_1-p_2)u 
\end{align*}
The adjoint equations are
\begin{align*}
	\dot{p_1} &= -H_{x_1} = -x_1 \\
	\dot{p_2} &= -H_{x_2} = -p_1
\end{align*}
Since $ t_f$ is free, and  $ H$ is time-independent, transversality yields  $ H \equiv 0$. 

\begin{enumerate}[label=(\alph*)]
\item Let us examine the optimality condition. By the PMP,
\begin{align*}
	u^*  = \argmin_u H = \begin{cases}
		-1 & p_1 - p_2 >0\\
		? & p_1 - p_2 =0\\
		1 & p_1 - p_2 <0
	\end{cases}
\end{align*}
Notice on the singular surface we have
\begin{align*}
	H = \frac{1}{2} x_1^2+x_1 x_2 &= 0 \\
	x_1(x_1+x_2) &= 0\\
	\implies x_1 =0 \text{ or } & x_1 = -2 x_2 
\end{align*}
Denote the surfaces by $ S_1$ and $ S_2$ respectively. Now we use GLC to obtain the optimal control on the singular surface
\begin{align*}
	\dot{H}_u &= \dot{p_1} - \dot{p_2} = -x_1 + p_1 \implies x_1 = p_1 = p_2 \\
	\ddot{H}_u &= -\dot{x_1} + \dot{p_1} = -x_2 - u - x_1 =0 \\
	u^* &= -(x_1 + x_2) 
\end{align*}
Moreover, since $ k=1$, $ (-1)^{1 } \frac{\partial }{\partial u} \ddot{H}_u = 1 >0 $ which passes GLC. Thus by definition of $ S_1$ and $S_2$,
\begin{align*}
	u^* = \begin{cases}
		-x_2 & \text{ on } S_1\\
		x_2 & \text{ on } S_2
	\end{cases}
\end{align*}
Notice that on $ S_1$, $ \dot{x_2} = x_2$ so $ x_2$ moves away from origin. On $ S_2$, we have
\begin{align*}
	\begin{cases}
		\dot{x_1} = 2x_2 \\
		\dot{x_2} = -x_2 \\
	\end{cases}
\end{align*}
which indicates that trajectory on $ S_2$ move toward the origin as time increases.
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{./figures/6.16.png}
	\caption{Switching surfaces: $ S_1$ is blue and $ S_2$ is green.}
\end{figure}
Now the initial point $ (0,-0.5)$ is on $ S_1$, we cannot continue on $ S_1$ as it moves away from the target. Hence we resort to bang-bang control. If $ u=1$, dynamics are
\begin{align*}
	\begin{cases}
		\dot{x_1} = x_2 + 1 & x_1(0) = 0\\
		\dot{x_2} = -1 & x_2(0) = -\frac{1}{2}
	\end{cases}
\end{align*}
which yields $ x_1 = -\frac{1}{2} \left( x_2+\frac{1}{2} \right)^2 - \frac{1}{2}\left(x_2+\frac{1}{2}\right) $. However, both its intersections with $ x_1 = -2 x_2$ are not achieved in the positive time direction.

If $ u = -1$, the dynamics are
\begin{align*}	
	\begin{cases}
		\dot{x_1} = x_2 - 1 & x_1(0) = 0\\
		\dot{x_2} = 1 & x_2(0) = -\frac{1}{2}
	\end{cases}
\end{align*}
which yields
\begin{align*}
	\begin{cases}
		x_1 (t) = \frac{1}{2} t^2 - \frac{3}{2} t \\
		x_2(t) = t-\frac{1}{2} \implies t = x_2 + \frac{1}{2}
	\end{cases}
\end{align*}
so we have the trajectory $ x_1 = \frac{1}{2} \left( x+\frac{1}{2} \right)^2 - \frac{3}{2} \left( x_2 + \frac{1}{2} \right)  $. This intersections with $ S_2$ at $ (-1, 0.5)$ which is achieved in positive time $ t=1$. Thus at this time we switch to singular control.
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{./figures/6.17.png}
	\caption{Optimal trajectory from initial point $ (0, -0.5)$.}
\end{figure}
\item Yes we can use bang-bang control only to reach the origin. We simply use the bang-bang control $ u=-1$ above and then switch to $ u=1$ which it intersects a bang-bang trajectory using $ u=1$ that reaches the origin. We find the latter trajectory with reversed time so that it goes through the origin at $ t=0$ for simplicity:
\begin{align*}
	\begin{cases}
		\dot{x_1} = x_2 + 1 & x_1(0) = 0\\
		\dot{x_2} = -1 & x_2(0) = 0
	\end{cases}
\end{align*}
which yields
\begin{align*}
	\begin{cases}
		x_1 (t) =- \frac{1}{2} t^2 + t \\
		x_2(t) = -t \implies t = -x_2 
	\end{cases}
\end{align*}
This gives the trajectory $ x_1 = -\frac{1}{2} x_2^2 - x_2$. The two bang-bang arcs intersect at $ (-1.1031,0.7906)$, with  $ t = -0.7906$. Thus the trajectory is
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{./figures/6.18.png}
	\caption{Bang-bang only trajectory.}
	\label{fig:6-18-png}
\end{figure}
\item For the optimal control, we see that the first intersection occurs at $ t_1 = x_2 + \frac{1}{2} = 1$. Moreover, since $ x_1 = p_1$, the adjoint equation becomes $ x_1 = - \dot{x_1}$. Thus
\begin{align*}
	\frac{1}{2} \int_{ 1}^{ T} x_1^2 dt &= -\frac{1}{2} \int_{ 1}^{ T} x_1 \dot{x_1} dt \\
	&= -\frac{1}{2} \int_{ 1}^{ T} \frac{d}{dt} x_1 \dot{x_1} dt  \\
	&= -\frac{1}{4} \left( x_1(T)^2 - x_1(1)^2 \right)  \\
	&= \frac{1}{4} x_1(1)^2 \\
	&= \frac{1}{4} 
\end{align*}
and
\begin{align*}
	J^*  = \frac{1}{2} \int_{ 0}^{ T} x_1^2 dt &= \frac{1}{2} \int_{ 0}^{ 1} x_1^2 dt + \frac{1}{2} \int_{ 1}^{ T} x_1^2 dt \\
	&= \frac{1}{2} \int_{ 0}^{ 1} \left( \frac{1}{2} t^2 - \frac{3}{2}t \right)^2 dt + \frac{1}{4}   \\
	&= 0.4625 
\end{align*}

From (d) we obtain that for bang-bang trajectory, $ t_1= 1.2906$. Thus
\begin{align*}
	J_{BB} &= \frac{1}{2} \int_{ 0}^{ T} x_1^2 dt \\ 
	&= \frac{1}{2} \int_{ 0}^{ 1.2906} \left( \frac{1}{2} t^2 - \frac{3}{2}t \right)^2 dt + \frac{1}{2} \int_{ -0.7906}^{ 0} \left( \frac{1}{2} t^2 + t  \right)^2    \\
	&= 0.3755 + 0.1389 = 0.5144
\end{align*}
\item Solving the dynamics on $ S_2$ with boundary condition $ x_1(1) =-1, x_2(1)= \frac{1}{2}$ yields
\begin{align*}
	\begin{cases}
		x_1(t) = -2.7183 e^{-t}\\
		x_2(t) = 1.3591 e^{-t}
	\end{cases}
\end{align*}
which is never going to reach $ (0,0)$ in finite time.

In the bang-bang case, we have  $ t_1 = x_2 + \frac{1}{2} = 0.7906 + 0.5 = 1.2906$ so $ T = t_1 + 0.7906 = 2.0812$.
\end{enumerate}
\end{problem}

\begin{problem}[3]
The Hamiltonian is
\begin{align*}
	H = 1 + p_1 x_2 + p_2 u .
\end{align*}
The adjoint equations are
\begin{align*}
	\dot{p_1} &= -H_{x_1} = 0 \\
	\dot{p_2} &= -H_{x_2} = - p_1 
\end{align*}
We see that $ p_1$ is constant and $ p_2$ is linear.
\begin{enumerate}[label=(\alph*)]
\item By PMP, we know that the optimal control is
\begin{align*}
	u^*  = \argmin_u H = \begin{cases}
		u_{\max} & p_2 < 0\\
		? & p_2 =0\\
		-u_{\max} & p_2 >0
	\end{cases}
\end{align*}
Since $ p_2$ is linear, it cannot be zero for more than one point. Otherwise, $ p_2 = p_1 \equiv 0$ which implies that $ H \equiv 1$. However, since $ t_f$ is free, we have  $ H \equiv 0$, a contradiction. It follows that
 \begin{align*}
	u^* = - \text{sign}(p_2) \cdot u_{\max} = \pm u_{ \max},  
\end{align*}
\emph{i.e.} we only have bang-bang control.
\item Let $ b := \pm u_{\max}$. Thus the dynamics of optimal trajectory are
	\begin{align*}
		\begin{cases}
			\dot{x_2} = b &\implies x_2(t) = bt+x_{20}\\
			\dot{x_1} = x_2 &\implies x_1(t) = bt^2 + x_{20}t+x_{10}
		\end{cases}
	\end{align*}
By substitution we have the optimal trajectory
\begin{align*}
	x_1-\left( x_{10} -\frac{1}{2b} x_{20}^2\right)  = \frac{1}{2b} x_2^2 ,
\end{align*}
for initial point $ (x_{10},x_{20})$. To have end points at $ (0,\pm 1)$, the optimal trajectory must have its last arc on one of the orange parabolas below. These are the switching curves.
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{./figures/6.9.png}
	\caption{The orange parabolas are the only optimal trajectories that go through $ (0,\pm 1)$. The cyan parabolas are other potential optimal trajectories. Given an initial point $ (x_{10},x_{20})$, there are always exactly two parabolas facing opposite directions that go through the point based on the equations above, and they always intersect at least one of the orange parabolas once. Note that the parabolas with mouth opening to the left goes down whereas the parabolas with mouth opening right goes up as time elapses. IMPORTANT NOTE: the switching curves terminate after reaching $ (0,\pm 1)$. That is, the orange curve that goes up stops at  $ (0,1)$. The orange curve that goes down stops at $ (0,-1)$.}
\end{figure}
\item By the reasons stated in the caption above, yes solution exists for all initial points. They might not be unique, as the $ (0,0)$ case illustrates below.
\item 
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\textwidth]{./figures/6.10.png}
	\caption{Due to symmetry, we see that there are two optimal trajectories from $ (0,0)$ to  $ (0,\pm 1)$.}
\end{figure}
~\begin{figure}[H]
	\centering
	\includegraphics[width=0.49\textwidth]{./figures/6.11.png}
	\includegraphics[width=0.49\textwidth]{./figures/6.12.png}
	\includegraphics[width=0.49\textwidth]{./figures/6.13.png}
	\includegraphics[width=0.49\textwidth]{./figures/6.14.png}
\end{figure}
\end{enumerate}
\end{problem}

\begin{problem}[4]
The Hamiltonian is
\begin{align*}
	H &= t^2 + x^2 + u^2 + pu\\
	H_u &= 2u+p \\
	H_{uu} &= 2 = R_2 >0\\
	H_{ux} &= 0 = R_{12} \\
	H_{x x} &= 2 = R_1 
\end{align*}
Moreover, $ A = \frac{\partial f}{\partial x} =0 $ and $ B = \frac{\partial f}{\partial u} =1$. Recall that for a regular problem, the existence of a conjugate point is equivalent to solution of associated Ricatti equation blowing up. We have
\begin{align*}
	\widetilde{ A} &= A - BR_2^{-1}R_{12}^{T} = 0- \frac{1}{2} \cdot 0 = 0 \\
	\Sigma &= BR_2^{-1}B = \frac{1}{2}\\
	\widetilde{ R} &= R_1- R_{12} R_2^{-1} R_{12}^{T} = 2-0 = 2 
\end{align*}
Thus the Ricatti equation is
\begin{align*}
	-\dot{s} &= \widetilde{ A} ^{T} s + s\widetilde{ A} - s \Sigma s + \widetilde{ R}\\
	-\dot{s} &= -\frac{1}{2} s ^2 + 2
\end{align*}
with $ s(t_f) = 0$. This yields
 \begin{align*}
	s(t) = 2 \tanh(t_f -t), 
\end{align*}
which is bounded! Thus we have no conjugate point.
\end{problem}
\begin{problem}[5]
\begin{enumerate}[label=(\alph*)]
\item The Hamiltonian is
	\begin{align*}
		H = 1+pu
	\end{align*}
with adjoint equation
\begin{align*}
	\dot{p} = 0
\end{align*}
which implies $ p$ is constant. We know  $ p \neq 0$ since otherwise  $ H \equiv 1$ but transversality gives  $ H \equiv 0$, a contradiction. Thus PMP gives
 \begin{align*}
	 u^* &= \begin{cases}
		-1 & p>0\\
		1 & p<0
	\end{cases}\\
	&= - \text{sign}(p)
\end{align*}
\item By letting $ b = - \text{sign}(p) $, we have $ \dot{x} = b$ which yields $ x(t) = bt+x_0$ with $0 =x(t_f) = bt_f + x_0$ so $ x_0 = -bt_f$. So the optimal value $ t_f = -b x_0$.
\item For closed-loop control, we want $ u^* $ in terms of  $ x$. Since we know that $ u$ is a constant, as above from the dynamics we get $ x(t) = ut+x_0$ so boundary condition yields $ u = - \frac{x_0}{ t_f}$. If $ x_0>0$, then since $ t_f >0$, we have $ \dot{x}=u=-1$, so $ x$ decreases as time elapses but remains $ >0$ until $ t_f$. If  $ x_0<0$, $ x$ increases with time but remains $ <0$ until $ t_f$. In either case, we see that $ u^*  = - \text{sign}(x) $. 
\end{enumerate}
\end{problem}
\end{document}
